---
title: "Determining Differences Between Forms of Writing Using Sentiment Analysis"
output:
  html_document:
    df_print: paged
---

In the realm of writing, one often distinguishes between fiction versus nonfiction. In many instances, one can determine if a document is fiction or nonfiction simply by its contents (exceptions not withstanding). If this is the case for humans, then perhaps it can also be assertained automatically.

To answer this, one could, for example, train a program to recognize the distinction between texts that are known to be fiction or nonfiction. However, for the sake of simplicity, this will not be done here. Instead, potential methods for investigating this distinction will be explored.

The most obvious method of such would be to examine common terms within reference documents, creating lexicons of terms that strongly indicate fiction or nonfiction. However, this approach is somewhat trivial. Perhaps there is a more interesting method that could potentially give insight.

A candidate lies in sentiment analysis, or the computational determination of the emotional content of text. One could assume, considering that fiction and nonfiction are intended for distinct functions, that the style of writing could be a prominent indicator. Sentiment is potentially useful in this regard.

A simple form of sentiment analysis is to give segments of a text a score based on how many words contained within have a particular sentiment. Because many fictional works have a narrative structure, perhaps the sentiment scores will respect that structure. This would make identifiable structure within the sentiment over time a distinguishing feature of fiction. Does this idea hold up?

Some works, such as Dante Alighieri's Divine Comedy, have a very obvious pattern, as can be seen in the graph generated by the following code.

```{r echo=TRUE}
library(tidyr)
library(dplyr)
library(magrittr)
library(ggplot2)
library(tidytext)
library(gutenbergr)

book_sentiment <- function(id, seg_length) {
  #id is the gutenberg_id of the desired document
  #seg_length is the number of lines that are analyzed at a time
  #This only works with text documents
  #This returns a tibble which associates each segment of the book with
  #a score based on the sentiment values of the words in the segment
  #This uses the Bing lexicon for scoring
  return(
    gutenberg_download(id) %>%
      mutate(linenumber = row_number()) %>%
      unnest_tokens(word, text) %>%
      inner_join(get_sentiments("bing")) %>%
      count(index = linenumber %/% seg_length, sentiment) %>%
      spread(sentiment, n, fill = 0) %>%
      mutate(sentiment = positive - negative)
    )
}

book_sentiment_graph <- function(id, seg_length) {
  #This creates a visual of the book_sentiment function
  book_sentiment(id, seg_length) %>%
    ggplot(aes(index, sentiment)) +
    geom_col()
}

book_sentiment_graph(1004, 1000)
```

This work shows a clear increase from very negative sentiment to very positive sentiment over the course of the narrative. Considering the actual content of the work, that being a journey through the afterlife whose ultimate conclusion is the protagonist meeting God, this comes as no surprise.

The problem with this type of analysis is revealed, however, when one begins to examine other works. For instance, Lewis Carroll's Through the Looking-Glass has a much more nonstandard structure.

```{r echo=TRUE}
library(tidyr)
library(dplyr)
library(magrittr)
library(ggplot2)
library(tidytext)
library(gutenbergr)

book_sentiment <- function(id, seg_length) {
  return(
    gutenberg_download(id) %>%
      mutate(linenumber = row_number()) %>%
      unnest_tokens(word, text) %>%
      inner_join(get_sentiments("bing")) %>%
      count(index = linenumber %/% seg_length, sentiment) %>%
      spread(sentiment, n, fill = 0) %>%
      mutate(sentiment = positive - negative)
    )
}

book_sentiment_graph <- function(id, seg_length) {
  book_sentiment(id, seg_length) %>%
    ggplot(aes(index, sentiment)) +
    geom_col()
}

book_sentiment_graph(12, 200)
```

The most noticeable feature of this text when compared to the Divine Comedy is that it does not follow a linear trend of some sort. Instead, it appears vaguely oscillatory. As it turns out, the issue with analyzing Through the Looking-Glass is that the way our score was done was by taking a count of positive sentiment words and subtracting a count of negative sentiment words. If we instead score based on counts of all emotionally-charged words, regardless of sentiment, then a much different picture emerges.

```{r echo=TRUE}
library(tidyr)
library(dplyr)
library(magrittr)
library(ggplot2)
library(tidytext)
library(gutenbergr)

book_sentiment_absolute <- function(id, seg_length) {
  return(
    gutenberg_download(id) %>%
      mutate(linenumber = row_number()) %>%
      unnest_tokens(word, text) %>%
      inner_join(get_sentiments("bing")) %>%
      count(index = linenumber %/% seg_length, sentiment) %>%
      spread(sentiment, n, fill = 0) %>%
      mutate(sentiment = positive + negative)
    )
}

book_sentiment_absolute_graph <- function(id, seg_length) {
  book_sentiment_absolute(id, seg_length) %>%
    ggplot(aes(index, sentiment)) +
    geom_col()
}

book_sentiment_absolute_graph(12, 200)
```

This shows much more consistent levels of sentiment content throughout the work. The main reason for the vast differences between the two analyses is that the Literary Nonsense that permeates much of the text throws off the standard scoring mechanism.

For completion's sake, the following is the Divine Comedy's absolute sentiment scores. It appears visually similar to Through the Looking-Glass in this regard.

```{r echo=TRUE}
library(tidyr)
library(dplyr)
library(magrittr)
library(ggplot2)
library(tidytext)
library(gutenbergr)

book_sentiment_absolute <- function(id, seg_length) {
  return(
    gutenberg_download(id) %>%
      mutate(linenumber = row_number()) %>%
      unnest_tokens(word, text) %>%
      inner_join(get_sentiments("bing")) %>%
      count(index = linenumber %/% seg_length, sentiment) %>%
      spread(sentiment, n, fill = 0) %>%
      mutate(sentiment = positive + negative)
    )
}

book_sentiment_absolute_graph <- function(id, seg_length) {
  book_sentiment_absolute(id, seg_length) %>%
    ggplot(aes(index, sentiment)) +
    geom_col()
}

book_sentiment_absolute_graph(1004, 1000)
```

All of the examples expolored so far have been fictional works. If a nonfiction work was analyzed, how different would it be?

As an example, here is Albert Einstein's Sidelights on Relativity put through a similar analysis.

```{r echo=TRUE}
library(tidyr)
library(dplyr)
library(magrittr)
library(ggplot2)
library(tidytext)
library(gutenbergr)

book_sentiment <- function(id, seg_length) {
  return(
    gutenberg_download(id) %>%
      mutate(linenumber = row_number()) %>%
      unnest_tokens(word, text) %>%
      inner_join(get_sentiments("bing")) %>%
      count(index = linenumber %/% seg_length, sentiment) %>%
      spread(sentiment, n, fill = 0) %>%
      mutate(sentiment = positive - negative)
    )
}

book_sentiment_graph <- function(id, seg_length) {
  book_sentiment(id, seg_length) %>%
    ggplot(aes(index, sentiment)) +
    geom_col()
}

book_sentiment_absolute <- function(id, seg_length) {
  return(
    gutenberg_download(id) %>%
      mutate(linenumber = row_number()) %>%
      unnest_tokens(word, text) %>%
      inner_join(get_sentiments("bing")) %>%
      count(index = linenumber %/% seg_length, sentiment) %>%
      spread(sentiment, n, fill = 0) %>%
      mutate(sentiment = positive + negative)
    )
}

book_sentiment_absolute_graph <- function(id, seg_length) {
  book_sentiment_absolute(id, seg_length) %>%
    ggplot(aes(index, sentiment)) +
    geom_col()
}

book_sentiment_graph(7333, 40)
book_sentiment_absolute_graph(7333, 40)
```

As one can easily see, the shape of the sentiment graphs, particularly the absolute graph, are unlike any of the fictional texts analyzed. There are two obvious explanations of this phenomenon: 1) the primary purpose of this text is to convey information, not to convey an experience, and 2) the text contains far more words that are considered neutral due to being scientific terms unfamiliar to most of the general public.

By now, one feature about the graphs of the sentiment scores that has not been discussed is the fact that, even with the texts whose absolute sentiment graphs looked vaguely similar, their upper and lower bounds were noticeably different. The reason for this is that the graphs were made to have similar numbers of segments, regardless of the actual length of the document. This leads to more text being in the segments for some documents when compared to others. However, despite the differences in the raw value, the similarity of the shapes of the graphs shows that the values attained are roughly proportional to the amount of text in a particular segment.

Due to both the problem of potentially cancelling sentiments and the fact that the scores are roughly proportional to the amount of text in a segment, perhaps a better measure of sentiment is the proportion of sentiment-charged terms within a document. The code used to calculate this proportion is displayed below.

To see if this proportion is a reasonable way to approximate fictionality, it shall be applied to multiple works, these being three fictional works followed by nonfiction works, with an emphasis on varying types of works for each category.

```{r echo=TRUE}
library(tidyr)
library(dplyr)
library(magrittr)
library(stringr)
library(ggplot2)
library(tidytext)
library(gutenbergr)

book_sentiment_ratio <- function(id) {
  temp_book <- gutenberg_download(id) %>%
    unnest_tokens(word, text) %>%
    left_join(get_sentiments("bing")) %>%
    count(sentiment)
  return(
    sum((filter(temp_book, (sentiment == "positive")|(sentiment == "negative")))[, 2])
    / sum(temp_book[, 2])
  )
}

print(str_glue("The Divine Comedy: ", as.character(book_sentiment_ratio(1004))))
print(str_glue("Through the Looking-Glass: ", as.character(book_sentiment_ratio(12))))
print(str_glue("The Prose Edda: ", as.character(book_sentiment_ratio(11))))
print(str_glue("Sidelights on Relativity: ", as.character(book_sentiment_ratio(7333))))
print(str_glue("The Voyage of the Beagle: ", as.character(book_sentiment_ratio(944))))
print(str_glue("The Declaration of Independence: ", as.character(book_sentiment_ratio(1))))
```

Upon examining the ratios, the two works that stand out are the Divine Comedy and Sidelights on Relativity. The Divine Comedy has a slightly higher ratio compared to the other works, and Sidelights has a somewhat lower one. However, it must be emphasized that, of this collection, Sidelights is the only nonfiction work to have a significantly lower ratio.

This most likely has to do with it being the only work in the collection dedicated to physics. The Voyage of the Beagle, while often delving into scientific observations, is first and foremost a travel journal, while the Declaration of Independence is a political document. It appears that the sentiment ratio is roughly inversely proportional to the amount of technical content in a nonfiction document.

To further examine these suspicions, the same sentiment ratio method was utilized on more nonfiction works, again of varying type.

```{r echo=TRUE}
library(tidyr)
library(dplyr)
library(magrittr)
library(stringr)
library(ggplot2)
library(tidytext)
library(gutenbergr)

book_sentiment_ratio <- function(id) {
  temp_book <- gutenberg_download(id) %>%
    unnest_tokens(word, text) %>%
    left_join(get_sentiments("bing")) %>%
    count(sentiment)
  return(
    sum((filter(temp_book, (sentiment == "positive")|(sentiment == "negative")))[, 2])
    / sum(temp_book[, 2])
  )
}

print(str_glue("Music Notation and Terminology: ", as.character(book_sentiment_ratio(19499))))
print(str_glue("The Gourmet's Guide to Europe: ", as.character(book_sentiment_ratio(18854))))
print(str_glue("The Plattsburg Manual: ", as.character(book_sentiment_ratio(19552))))
print(str_glue("Celebrated Crimes: ", as.character(book_sentiment_ratio(2760))))
print(str_glue("The Mechanical Properties of Wood: ", as.character(book_sentiment_ratio(12299))))
```

The values achieved by these works imply that our prior suspicions have some merit. Unsurprisingly, Celebrated Crimes places high, due to its inherently dark subject matter. Arranging the remaining works in order of decreasing sentiment shows a pattern of increasing technicality.

The conclusion that can be drawn from these observations is that low sentiment ratios are a potential indicator of technicality, but are not sufficient to detect nonfiction as a whole. A potential supplement would be examining the sentiment over time to potentially catch any works that slip through the cracks. However, even this combined method is not perfect, due to the wide variety of styles a work could potentially be in.